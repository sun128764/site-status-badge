# WebP åŠŸèƒ½å¿«é€Ÿå¼€å§‹æŒ‡å—

## å¿«é€Ÿå‘½ä»¤

### ç”Ÿæˆ WebP æ–‡ä»¶
```bash
pnpm generate-webp
```
è¿™ä¼šï¼š
1. ä¸ºæ‰€æœ‰ç½‘ç«™ç”Ÿæˆ 28 ä¸ª WebP æ–‡ä»¶ï¼ˆ2 ä¸ªçŠ¶æ€ Ã— 7 ä¸ªç½‘ç«™ Ã— 2 ä¸ªå°ºå¯¸ï¼‰
2. å°†å®ƒä»¬ç¼–ç åˆ° TypeScript æ–‡ä»¶ä¸­
3. ç”Ÿæˆæ¸…å•æ–‡ä»¶

### éƒ¨ç½²ï¼ˆè‡ªåŠ¨åŒ…å« WebP ç”Ÿæˆï¼‰
```bash
pnpm deploy
```

### å¼€å‘æ¨¡å¼ï¼ˆéœ€å…ˆæ‰‹åŠ¨ç”Ÿæˆ WebPï¼‰
```bash
pnpm generate-webp  # å…ˆç”Ÿæˆ WebP
pnpm dev            # å†å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```

## API ç«¯ç‚¹

### SVG å¾½ç« ï¼ˆåŸæœ‰ï¼‰
```
GET /badge/{siteKey}
```

### WebP å¾½ç« ï¼ˆæ–°å¢ï¼‰
```
GET /badge/{siteKey}.webp
```

## æ”¯æŒçš„ç½‘ç«™

ç›®å‰æ”¯æŒçš„ siteKeyï¼š
- `vcbs` - VCB-Studio
- `dmhy` - Dymy
- `bangumi` - Bangumi Moe
- `nyaa` - Nyaa.si
- `acgrip` - ACG.RIP
- `acgnxa` - ACG-NX (acgnx.se)
- `acgnxg` - ACG-NX (acgnx.se)

## æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ index.ts              # ä¸»ç¨‹åºï¼ŒåŒ…å« SVG å’Œ WebP ç«¯ç‚¹
â”œâ”€â”€ sites.ts              # ç½‘ç«™é…ç½®
â”œâ”€â”€ badge.ts              # SVG ç”Ÿæˆ
â”œâ”€â”€ generate-webp.ts      # WebP ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ upload-webp.ts        # WebP ç¼–ç è„šæœ¬
â””â”€â”€ webp-data.ts          # è‡ªåŠ¨ç”Ÿæˆï¼ˆä¸è¦ç¼–è¾‘ï¼‰

public/
â”œâ”€â”€ vcbs-0-default.webp   # ç¦»çº¿çŠ¶æ€ï¼ˆåŸå§‹å°ºå¯¸ï¼‰
â”œâ”€â”€ vcbs-0-2x.webp        # ç¦»çº¿çŠ¶æ€ï¼ˆ2å€å°ºå¯¸ï¼‰
â”œâ”€â”€ vcbs-1-default.webp   # åœ¨çº¿çŠ¶æ€ï¼ˆåŸå§‹å°ºå¯¸ï¼‰
â”œâ”€â”€ vcbs-1-2x.webp        # åœ¨çº¿çŠ¶æ€ï¼ˆ2å€å°ºå¯¸ï¼‰
â””â”€â”€ ... (å…¶ä»–ç½‘ç«™)
```

## å·¥ä½œåŸç†

1. **ç”Ÿæˆé˜¶æ®µ** (`generate-webp.ts`)
   - ä»ç½‘ç«™åˆ—è¡¨è¯»å–æ‰€æœ‰ç½‘ç«™
   - ä¸ºæ¯ä¸ªç½‘ç«™çš„ä¸¤ä¸ªçŠ¶æ€ç”Ÿæˆ SVG
   - ä½¿ç”¨ Sharp åº“å°† SVG è½¬æ¢ä¸º WebP
   - ä¿å­˜åˆ° `/public` ç›®å½•

2. **ç¼–ç é˜¶æ®µ** (`upload-webp.ts`)
   - è¯»å– `/public` ä¸­çš„æ‰€æœ‰ WebP æ–‡ä»¶
   - è½¬æ¢ä¸º Base64 ç¼–ç 
   - ç”Ÿæˆ TypeScript å¯¼å‡ºæ–‡ä»¶ (`webp-data.ts`)

3. **æœåŠ¡é˜¶æ®µ** (`index.ts`)
   - æ¥æ”¶è¯·æ±‚åˆ° `/badge/{siteKey}.webp`
   - æ£€æŸ¥ç½‘ç«™çŠ¶æ€ï¼ˆåœ¨çº¿/ç¦»çº¿ï¼‰
   - ä» `webp-data.ts` è·å–å¯¹åº”çš„ Base64 æ•°æ®
   - è§£ç ä¸º ArrayBuffer
   - è¿”å›ç»™å®¢æˆ·ç«¯

## ä½•æ—¶é‡æ–°ç”Ÿæˆ WebP

éœ€è¦é‡æ–°ç”Ÿæˆçš„æƒ…å†µï¼š
## ä½•æ—¶é‡æ–°ç”Ÿæˆ WebP

## å¸¸è§é—®é¢˜
- âœ… è‡ªåŠ¨ï¼šéƒ¨ç½²å‰ï¼ˆ`pnpm deploy` è‡ªåŠ¨è¿è¡Œï¼‰
- ğŸ”„ æ‰‹åŠ¨ï¼šå¼€å‘å‰ï¼ˆ`pnpm generate-webp`ï¼Œç„¶åè¿è¡Œ `pnpm dev`ï¼‰
- ğŸ”„ æ‰‹åŠ¨ï¼šä¿®æ”¹ç½‘ç«™é…ç½®åï¼ˆ`pnpm generate-webp`ï¼‰
- ğŸ”„ æ‰‹åŠ¨ï¼šä¿®æ”¹å¾½ç« æ ·å¼åï¼ˆ`pnpm generate-webp`ï¼‰

### Q: WebP æ–‡ä»¶ä¼šå ç”¨å¾ˆå¤šç©ºé—´å—ï¼Ÿ
A: ä¸ä¼šã€‚28 ä¸ª WebP æ–‡ä»¶æ€»å…±ä»… ~116KBï¼Œç¼–ç åçš„ `webp-data.ts` çº¦ 92KBã€‚

### Q: èƒ½å¦ä½¿ç”¨ 2x å°ºå¯¸çš„ WebPï¼Ÿ
A: å¯ä»¥ï¼Œä½†ç›®å‰ç«¯ç‚¹åªè¿”å› default å°ºå¯¸ã€‚ä¿®æ”¹ `index.ts` çš„ `webpKey` æ„å»ºé€»è¾‘å³å¯æ”¯æŒã€‚

### Q: WebP ç›¸å¯¹ SVG æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ
A: 
- æŸäº›ä¸æ”¯æŒ SVG çš„ç¯å¢ƒï¼ˆå¦‚æŸäº› Markdown æ¸²æŸ“å™¨ï¼‰å¯ä»¥ä½¿ç”¨
- æ–‡ä»¶æ›´å°ï¼ˆçº¦ 50% çš„ SVG å¤§å°ï¼‰
- åŠ è½½æ›´å¿«

### Q: å¦‚ä½•æ·»åŠ æ–°ç½‘ç«™ï¼Ÿ
A: 
1. åœ¨ `src/sites.ts` çš„ `SITES` å¯¹è±¡ä¸­æ·»åŠ ç½‘ç«™
2. è¿è¡Œ `pnpm generate-webp`
3. å®Œæˆï¼æ–°ç½‘ç«™çš„ WebP ç«¯ç‚¹è‡ªåŠ¨å¯ç”¨

## æ•…éšœæ’æŸ¥

### ç”Ÿæˆå¤±è´¥ï¼šæ‰¾ä¸åˆ° Sharp
```bash
pnpm add sharp --save-dev
```

### ç”Ÿæˆå¤±è´¥ï¼šæ‰¾ä¸åˆ° tsx
```bash
pnpm add tsx --save-dev
```

### webp-data.ts æ–‡ä»¶è¿‡å¤§
è¿™æ˜¯æ­£å¸¸çš„ï¼Œæ‰€æœ‰ WebP Base64 æ•°æ®éƒ½å­˜å‚¨åœ¨è¯¥æ–‡ä»¶ä¸­ã€‚

### ç«¯ç‚¹è¿”å› 404
ç¡®ä¿å·²è¿è¡Œ `pnpm generate-webp` æ¥ç”Ÿæˆå¿…è¦çš„æ–‡ä»¶ã€‚

## æ€§èƒ½æç¤º

- WebP ç«¯ç‚¹ä½¿ç”¨ç›¸åŒçš„ç¼“å­˜ç­–ç•¥ï¼ˆ5 åˆ†é’Ÿ CDN ç¼“å­˜ï¼‰
- Base64 ç¼–ç å¢åŠ äº†çº¦ 33% çš„å¤§å°ï¼Œä½†èŠ‚çœäº†ç½‘ç»œè¯·æ±‚
- æ€»ä½“å¤§å°ä»å°äº SVGï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜æ¸…å±å¹•ä¸Š
